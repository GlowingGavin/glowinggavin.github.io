<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Plains Village</title>

<style>
html, body {
    margin:0;
    padding:0;
    height:100%;
    background:#111;
    display:flex;
    flex-direction:column;
    align-items:center;
    font-family:Arial;
}

input {
    margin:15px;
    padding:8px;
    width:320px;
    font-size:14px;
}

#grid {
    display:grid;
    gap:6px;
}

.cell {
    background:#1a1a1a;
    border:1px solid #333;
    display:flex;
    align-items:center;
    justify-content:center;
}

.cell img {
    width:100%;
    height:100%;
    object-fit:contain;
}
</style>
</head>
<body>

<input id="seedInput" placeholder="64-bit seed (dec or hex)">
<div id="grid"></div>

<script>
class SplitMix64 {
    constructor(seed){ this.state = BigInt.asUintN(64, seed); }
    next(){
        this.state = BigInt.asUintN(64, this.state + 0x9E3779B97F4A7C15n);
        let z = this.state;
        z = BigInt.asUintN(64, (z^(z>>30n))*0xBF58476D1CE4E5B9n);
        z = BigInt.asUintN(64, (z^(z>>27n))*0x94D049BB133111EBn);
        return BigInt.asUintN(64, z^(z>>31n));
    }
    nextInt(max){ return Number(this.next() % BigInt(max)); }
}

const CENTERS = [
"Plains_Fountain_1.png",
"Plains_Meeting_Point_1.png",
"Plains_Meeting_Point_2.png",
"Plains_Meeting_Point_3.png",
"Plains_Meeting_Point_4.png",
"Plains_meeting_point_5.png"
];

const HOUSES = [
["Plains_Small_House_1.png",2],
["Plains_Small_House_2.png",2],
["Plains_Small_House_3.png",2],
["Plains_Small_House_4.png",2],
["Plains_Small_House_5.png",2],
["Plains_Small_House_6.png",1],
["Plains_Small_House_7.png",2],
["Plains_Small_House_8.png",3],
["Plains_Medium_House_1.png",2],
["Plains_Medium_House_2.png",2],
["Plains_big_house_1.png",2],
["Plains_Butcher_Shop_1.png",2],
["Plains_butcher_shop_2.png",2],
["Plains_tool_smith_house_1.png",2],
["Plains_Fletcher_House_1.png",2],
["Plains_shepherd_house.png",2],
["Plains_Armorer_House_1.png",2],
["Plains_fisher_cottage_1.png",2],
["Plains_Tannery_1.png",2],
["Plains_Cartographer_1.png",1],
["Plains_library_1.png",5],
["Plains_library_2.png",1],
["Plains_masons_house_1.png",2],
["Plains_weaponsmith_1.png",2],
["Plains_temple_3.png",2],
["Plains_Temple_4.png",2],
["Plains_Stable_1.png",2],
["Plains_Stable_2.png",2],
["Plains_large_farm_1.png",4],
["Plains_Small_Farm_1.png",4],
["Plains_animal_pen_1.png",1],
["Plains_animal_pen_2.png",1],
["Plains_Animal_Pen_3.png",5],
["Plains_Accessory_1.png",1]
];

function parseSeed(s){
    if(!s) return 0n;
    s=s.trim();
    if(s.startsWith("0x")||s.startsWith("0X")) return BigInt(s);
    return BigInt(s);
}

function weightedPick(rng){
    let total=0;
    for(const h of HOUSES) total+=h[1];
    let r=rng.nextInt(total);
    for(const h of HOUSES){
        r-=h[1];
        if(r<0) return h[0];
    }
}

function resizeGrid(){
    const rows = 5;
    const cols = 7;
    const gap = 6;

    const maxWidth = window.innerWidth * 0.95;
    const maxHeight = window.innerHeight * 0.8;

    const tileSize = Math.floor(
        Math.min(
            (maxWidth - (cols-1)*gap) / cols,
            (maxHeight - (rows-1)*gap) / rows
        )
    );

    grid.style.gridTemplateColumns = `repeat(${cols}, ${tileSize}px)`;
    grid.style.gridTemplateRows = `repeat(${rows}, ${tileSize}px)`;
}

function generate(){
    const rng=new SplitMix64(parseSeed(seedInput.value));
    grid.innerHTML="";

    // ðŸ”¥ Move center RNG BEFORE grid loop
    const centerPick = rng.nextInt(CENTERS.length);

    for(let r=0;r<5;r++){
        for(let c=0;c<7;c++){
            const cell=document.createElement("div");
            cell.className="cell";

            let imgName=null;

            if(r===2 && c===3){
                imgName=CENTERS[centerPick];
            } else {
                if(rng.nextInt(4)===0){
                    imgName=weightedPick(rng);
                }
            }

            if(imgName){
                const img=document.createElement("img");
                img.src="buildings/"+imgName;
                cell.appendChild(img);
            }

            grid.appendChild(cell);
        }
    }
}

seedInput.addEventListener("input",()=>{ try{generate();}catch{} });

window.addEventListener("resize",resizeGrid);

resizeGrid();
generate();
</script>

</body>
</html>